---
layout: default
title: Mutation Testing
parent: Demo
grand_parent: Primer
nav_order: 10
permalink: docs/primer/demo/mutation/
---

# Mutation Testing
{: .no_toc }

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

## PIT Mutation Testing

We developed this application using a [TDD approach](https://martinfowler.com/bliki/TestDrivenDevelopment.html).  Yet we do not know how well tested our application is.  We do not have means to quantify the test coverage.  There are various approaches to verify how well tested our application is.

One of these approaches is [mutation testing](https://en.wikipedia.org/wiki/Mutation_testing).  Different from other approaches, mutation testing intelligently modifies the code, known as _mutations_, and verifies whether each modification is caught by a test or not.  If all mutations are caught by a test, then our code is well tested.  If a mutation does not break a test, then we have code which is not covered by tests.  This is better than simply test coverage as it is verifying that the test actually fails.

[PIT Mutation Testing](https://pitest.org/) is a mutation testing library we can use to measure how well our code is tested and highlight any areas that are not well tested.

1. Add the [PIT test plugin](https://plugins.gradle.org/plugin/info.solidsoft.pitest) and configure it to run with JUnit 5.

   ```groovy
   plugins {
     id 'info.solidsoft.pitest' version '1.5.1'
   }

   pitest {
     targetClasses = ['demo.boot.*']
     junit5PluginVersion = '0.12'
     timestampedReports = false
   }
   ```

1. Run the `pitest` gradle task

   ```bash
   $ ./gradlew clean pitest

   ...

   BUILD SUCCESSFUL in 17s
   5 actionable tasks: 5 executed
   ```

1. This task, produces a report showing the test coverage

   ```bash
   $ open build/reports/pitest/demo.boot/index.html
   ```

   ![Pit Test Coverage Report With Lombok.png]({{ '/assets/images/Pit-Test-Coverage-Report-With-Lombok.png' | absolute_url }})

   Note that the report includes the `Office` class shown next.

   ```java
   package demo.boot;

   import lombok.AllArgsConstructor;
   import lombok.Data;
   import lombok.NoArgsConstructor;

   @Data
   @NoArgsConstructor
   @AllArgsConstructor
   public class Office {

     private String office;
     private String address;
     private String phone;
     private String email;
   }
   ```

   This class is generated by Lombok can be excluded from PIT Mutation Testing.

1. Exclude the Lombok generated files

   Create file `lombok.config`

   ```properties
   lombok.addLombokGeneratedAnnotation=true
   ```

   Re-run the `pitest` task

   ```bash
   $ ./gradlew clean pitest
   ```

   Open the report

   ```bash
   $ open build/reports/pitest/demo.boot/index.html
   ```

   ![Pit Test Coverage Report Without Lombok.png]({{ '/assets/images/Pit-Test-Coverage-Report-Without-Lombok.png' | absolute_url }})

   The `Office` class is now excluded.

1. Analyse the report

   ![Pit Test Coverage Report Analyse Report.png]({{ '/assets/images/Pit-Test-Coverage-Report-Analyse-Report.png' | absolute_url }})

   Note that our service class, `ContactUsService`, is not well covered.  The reader may throw an exception which is not covered by a test.
